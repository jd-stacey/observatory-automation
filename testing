def _abort_current_exposure(self) -> bool:
    """Abort current camera exposure if possible"""
    if not self.main_camera or not self.main_camera.connected:
        return False
    
    try:
        cam = self.main_camera.camera
        if hasattr(cam, 'AbortExposure'):
            cam.AbortExposure()
            self.logger.info("Aborted current exposure")
            return True
        else:
            self.logger.warning("Camera does not support exposure abortion")
            return False
    except Exception as e:
        self.logger.warning(f"Failed to abort exposure: {e}")
        return False

def stop_session(self):
    """Stop the current imaging session"""
    self.logger.info("Stopping spectroscopy session...")
    
    # Try to abort any ongoing exposure first
    self._abort_current_exposure()
    
    # Then set stop flags
    self._stop_event.set()
    self._running = False
    
    # Wait for imaging thread to finish (with timeout)
    if hasattr(self, 'imaging_thread') and self.imaging_thread.is_alive():
        self.imaging_thread.join(timeout=5.0)
        if self.imaging_thread.is_alive():
            self.logger.warning("Imaging thread did not stop cleanly")
