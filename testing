if args.test_acquisition:
        try:
            session = ImagingSession(
                camera_manager=None,  # No camera needed for test
                corrector=None,       # No corrector needed for test
                config_loader=config_loader,
                target_info=target_info, 
                filter_code=args.filter.upper(),
                ignore_twilight=args.ignore_twilight,
                exposure_override=args.exposure_time
            )
        except ImagingSessionError:
            logger.warning("Could not create session for testing - continuing with dry run")
            session = None

# ADD THE TEST CODE HERE - OUTSIDE BOTH IF/ELSE BLOCKS:
if args.test_acquisition and session:
    logger.info("Running acquisition flow test...")
    test_success = session.test_acquisition_flow(simulate_corrections=True)
    if test_success:
        logger.info("Acquisition test completed successfully")
        return 0
    else:
        logger.error("Acquisition test failed")
        return 1
