def _create_complete_target_json(self, target_dir: Path):
    """Update target JSON to point to the specified directory"""
    from autopho.targets.resolver import TICTargetResolver
    resolver = TICTargetResolver()
    target_json_data = resolver.create_target_json(self.target_info)
    
    # Handle case where main_camera is None (for testing)
    camera_name = self.main_camera.name if self.main_camera else "test_camera"
    camera_device_id = self.main_camera.device_id if self.main_camera else "test_device"
    
    target_json_data.update({
        "camera_name": camera_name,
        "camera_device_id": camera_device_id,
        "filter_code": self.filter_code,
        "raw_images_directory": str(target_dir),
        "tel": self.file_manager.telescope_id.replace('T', ''),
        "imaging_phase": self.current_phase.value
    })
    
    if self.config_loader.write_target_json(target_json_data):
        logger.info(f"Target JSON updated for {self.current_phase.value} phase: {target_dir}")
    else:
        logger.warning("Failed to write target JSON for external platesolver")
