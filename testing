def _initialize_components(self):
    try:
        # Handle camera initialization - allow None for testing
        if self.camera_manager:
            self.main_camera = self.camera_manager.get_main_camera()
            if not self.main_camera:
                raise ImagingSessionError("Main camera not found")
            
            if not self.main_camera.connected:
                if not self.main_camera.connect():
                    raise ImagingSessionError("Failed to connect to main camera")
        else:
            # For testing mode - create a mock camera object or set to None
            self.main_camera = None
            logger.info("Running in test mode - no camera initialized")
        
        self.file_manager = FileManager(self.config_loader)
        
        # Create both acquisition and science directories
        base_target_dir = self.file_manager.create_target_directory(self.target_info.tic_id)
        
        if self.acquisition_enabled:
            # Create acquisition directory
            folder_suffix = self.acquisition_config.get('folder_suffix', '_acq')
            acq_dir_name = base_target_dir.name + folder_suffix
            self.acquisition_dir = base_target_dir.parent / acq_dir_name
            self.acquisition_dir.mkdir(parents=True, exist_ok=True)
            
            # Science directory is the normal one
            self.science_dir = base_target_dir
            
            # Start with acquisition directory
            self.current_target_dir = self.acquisition_dir
            self.current_phase = SessionPhase.ACQUISITION
            logger.info(f"Acquisition mode enabled - starting in: {self.acquisition_dir}")
        else:
            # Skip acquisition, go straight to science
            self.science_dir = base_target_dir
            self.current_target_dir = self.science_dir
            self.current_phase = SessionPhase.SCIENCE
            logger.info("Acquisition mode disabled - starting science imaging")
        
        # Create initial target JSON pointing to current directory
        self._create_complete_target_json(self.current_target_dir)
        
        observatory_config = self.config_loader.get_config('observatory')
        self.observability_checker = ObservabilityChecker(observatory_config)
        
        logger.debug(f"Session initialized: {self.target_info.tic_id}, Filter: {self.filter_code}")
        if self.main_camera:
            logger.debug(f"Camera: {self.main_camera.name}")
        logger.debug(f"Current phase: {self.current_phase.value}")
        
    except Exception as e:
        raise ImagingSessionError(f"Failed to initialize session: {e}")
